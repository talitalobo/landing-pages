---
title: "Intervalos de Confiança"
author: "Ad1 - Allan Sales e Talita Lôbo"
output: html_document
---

```{r, echo=FALSE, warning=FALSE}
require("Rmisc", quietly=T, warn.conflicts=F)
require("asbio", quietly=T, warn.conflicts=F)
```

```{r, echo=FALSE, warning=FALSE}

# ------------------- media  
prop.acertos.media <- function(populacao, n.Amostras, tamAmostra){
  
  amostras <- data.frame(upper = numeric(nAmostras), mean = numeric(nAmostras), lower = numeric(nAmostras))

  for(i in 1:nAmostras){
    amostra <- sample(populacao, tamAmostra)
    amostras[i,] <- CI(amostra)
  }
  pop.media <- mean(populacao)
  amostras$cont.pop.media <- (amostras$upper >= pop.media & amostras$lower <= pop.media)
  
  return(prop.table(table(amostras$cont.pop.media)))
}


# ------------------- mediana 
prop.acertos.mediana <- function(populacao, n.Amostras, tamAmostra){
  
  amostras <- data.frame(lower = numeric(nAmostras), upper = numeric(nAmostras))
  
  for(i in 1:nAmostras){
    amostra <- sample(populacao, tamAmostra)
    amostras[i,] <- quantile(amostra, c(.025, 0.975))
  }
  
  pop.mediana <- median(populacao)
  amostras$cont.pop.mediana <- (amostras$upper >= pop.mediana & amostras$lower <= pop.mediana)
  
  return(prop.table(table(amostras$cont.pop.mediana)))
}

populacao.norm <- rnorm(100)
outliers <- c(30,20,10)
```

-------------------------------------

Neste exemplo, criamos dois conjuntos que representam uma população qualquer de tamanho 100. Uma primeira, que segue a distribuição normal, e uma segunda que é igual a primeira mas com a adição de alguns outliers.

```{r, warning=FALSE}
populacao.norm <- rnorm(100)
populacao.norm.out <- c(populacao.norm, outliers)
```

Para provar que o intervalo de confiança de uma amostra aleatória significativa dessa população contém a média/mediana da população com confiança de x% (no nosso exemplo estamos usando sempre 95%), foram coletados nAmostras aleatórias de tamanho nObservacoes e calculado o intervalo de confiança para cada uma delas. Para cada intervalo, foi verificado se ele contém a média/mediana da população. O resultado dos casos 1 e 2 mostram a proporção de quantos intervalos continham a média e os casos 3 e 4 mostram a proporção para a mediana.

```{r, warning=FALSE}
nAmostras <- 500
nObservacoes <- 25
```

### Caso 1: Cálculo da média para população normal

```{r, warning=FALSE}
prop.acertos.media(populacao.norm, nAmostras, nObservacoes)
```

### Caso 2: Cálculo da média para população normal com outliers
```{r, warning=FALSE}
prop.acertos.media(populacao.norm.out, nAmostras, nObservacoes)
```

A conclusão é que pra a distribuição normal, com 95% de confiança, realmente observamos a média da população em pelo menos 95% dos intervalos de confiança. Já para o caso de adicionarmos outliers à distribuição, esse resultado não é verdade.

### Caso 3: Cálculo da mediana para população normal
```{r, warning=FALSE}
prop.acertos.mediana(populacao.norm, nAmostras, nObservacoes)
```

### Caso 4: Cálculo da mediana para população normal com outliers
```{r, warning=FALSE}
prop.acertos.mediana(populacao.norm.out, nAmostras, nObservacoes)
```

Para o caso da mediana, é possível concluir que com 95% de confiança, observamos a mediana da população em pelo menos 95% dos intervalos de confiança para os dois casos.


### Utilizando o t-test

O teste t pode ser utilizado para:   

* comparar uma amostra com uma população;
* comparar duas amostrar pareadas (mesmo sujeito em dois momentos diferentes);
* comparar duas amostras independentes;   

com o objetivo de verificar a existência entre a diferença entre a média de uma amostra (aleatória) e a média populacional.

```{r, warning=FALSE}

#populacao.norm <- rnorm(100)
#outliers <- c(30,20,10)

nAmostras <- 500
nObservacoes <- 25

# ----------------------------------------------------------

amostras <- data.frame(upper = numeric(nAmostras), mean = numeric(nAmostras), lower = numeric(nAmostras))

for(i in 1:nAmostras){
  amostra <- sample(populacao.norm, nObservacoes)
  amostras[i,] <- CI(amostra)
}
pop.media <- mean(populacao.norm)
amostras$cont.pop.media <- (amostras$upper >= pop.media & amostras$lower <= pop.media)

tab <- prop.table(table(amostras$cont.pop.media))



# prop.acertos.media(populacao.norm, nAmostras, nObservacoes)
#                   (populacao, n.Amostras, tamAmostra)

# ----------------------------------------------------------

```
4. fazer 1 e 2 com o t.test, avaliando se a média das amostras é significativamente diferente da média da população. 

### Utilizando o wilcoxon test
```{r, warning=FALSE}


```
5. fazer 1 e 2 com o wilcoxon.test








